# AI 代理開發準則 (v2.0 - 2025-09-02)

本文件概述了開發與測試此專案的具體要求和限制。所有在此儲存庫中工作的 AI 代理都必須遵守這些準則。

## 1. 核心開發原則

### 1.1. 語言與溝通 (Language and Communication)

**❗❗❗ 極度重要 (CRITICAL) ❗❗❗**

**全程必須使用「繁體中文」進行溝通。**

這包括但不限於：
*   **使用者訊息**：所有與使用者的互動和回覆。
*   **程式碼註解**：所有新撰寫或修改的程式碼註解。
*   **提交訊息**：Git 的提交標題和內文。
*   **技術文件**：所有 `.md` 檔案的更新。
*   **日誌與輸出**：在不影響程式運作的前提下的所有輸出訊息。

此要求是專案的最高優先級之一，請務必遵守。

### 1.2. 日誌記錄 (`Log.md`) SOP

為了保持專案歷史的可追溯性，**每次提交 (Submit) 前，都必須更新 `Log.md` 檔案**。

**標準作業流程**:
1.  **生成標準時間戳記**:
    *   執行我們為此目的建立的輔助工具：
        ```bash
        python scripts/time.py
        ```
    *   此命令會輸出一個標準格式的台北時區時間 (例如 `2025-09-02T10:00:00+08:00`)。
2.  **撰寫日誌條目**:
    *   在 `Log.md` 的最頂部新增一則日誌。
    *   日誌標題應包含一個唯一的、遞增的編號 (例如 `## 980號 - ...`) 和剛剛生成的時間戳記。
    *   內容應清晰地總結本次變更的**動機**、**核心變更**、**測試**與**成果**。

---

## 2. 當前專案狀態與開發重點

**🔥 目前焦點：前端架構重構 🔥**

目前，本專案正在進行一次**大規模的前端架構重構**，旨在從根本上解決 UI 的穩定性與可預測性問題。

*   **目標架構**: **單向資料流 (Unidirectional Data Flow)**。
*   **核心檔案**: `src/static/mp3.html`。
*   **指導文件**: 所有重構工作都必須嚴格遵循使用者提供的**「前端架構重構執行計畫書」**。該計畫書詳細定義了新的狀態管理、渲染機制和事件處理模型。

**給所有 AI 代理的指示**:
*   在重構完成前，**所有新的前端功能請求都應優先考慮是否符合新的架構**。
*   任何對 `src/static/mp3.html` 的修改，都必須以推進重構計畫為目標。
*   在不確定的情況下，應重新審閱計畫書或與使用者確認。

---

## 3. 環境與工具須知

### 3.1. 版本號更新 (Colab)
若您的任務涉及修改 `colabPro.py`，請遵循以下流程：
*   **更新開發者日誌**: 在檔案頂部的 `開發者日誌` 區塊，更新 `版本` 和 `日期`，並簡述變更。
*   **更新標題版本號**: 更新 `#@title` 中的版本號 (例如 `v9` -> `v9.1`)。

### 3.2. 注意程序超時
系統設有保護機制，如果任何程序在 **2 分鐘** 內沒有任何日誌輸出，將被視為無回應並被自動終止。在執行長時間任務時，請確保有持續的日誌輸出。

### 3.3. 工具使用限制
*   **⚠️【圖片格式限制】**: 內建的圖片檢視工具 (`view_image`, `read_image_file`) 目前**僅支援 JPG (`.jpg`, `.jpeg`) 格式**。在處理圖片 URL 或本地圖片檔案時，請務必注意此限制。

---

## 4. 測試與執行規範 (Testing and Execution Policy)

### 4.1. 禁止自動化端對端測試 (No Automated E2E Testing)

**❗ 強制規定 (MANDATORY) ❗**

**嚴格禁止**在本環境中安裝或使用 Playwright、Selenium、Cypress 等大型自動化端對端 (E2E) 測試框架。這些工具會下載大量依賴套件，可能導致環境崩潰。所有前端驗證都應透過手動測試或與使用者協作完成。

### 4.2. 執行前須獲使用者確認 (User Confirmation Required for Execution)

**❗ 強制規定 (MANDATORY) ❗**

在虛擬環境中執行任何**測試腳本**或**可能影響系統狀態的命令**之前，**必須**先向使用者提出您的執行計畫並獲得明確的**「確認」**或**「授權」**。這是一個強制性的安全與協作步驟。

---
## 5. 本地開發與測試指南 (Local Development & Testing)

為了在本地環境中進行輕量級的開發與測試，我們已將標準的啟動與驗證流程記錄在 `test.md` 檔案中。

**所有開發者在進行測試前，都應優先參考 `test.md`。** 該文件詳細說明了如何：
-   只安裝核心依賴，避免下載大型套件。
-   使用正確的主協調器 (`orchestrator.py`) 來啟動應用。
-   驗證服務是否成功啟動。

遵循此文件可以大幅提升開發效率並避免環境問題。
